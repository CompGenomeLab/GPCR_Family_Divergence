#!/bin/bash
#
# CompecTA (c) 2018
#
# TODO:
#   - Set name of the job below changing "NAMD" value.
#   - Set the requested number of nodes (servers) with --nodes parameter.
#   - Set the requested number of tasks (cpu cores) with --ntasks parameter. (Total accross all nodes)
#   - Select the partition (queue) you want to run the job in:
#     - short : For jobs that have maximum run time of 120 mins. Has higher priority.
#     - mid   : For jobs that have maximum run time of 1 days. Lower priority than short.
#     - long  : For jobs that have maximum run time of 7 days. Lower priority than long.
#     - longer: For testing purposes, queue has 15 days limit but only 2 nodes.
#     - cuda  : For CUDA jobs. Solver that can utilize CUDA acceleration can use this queue. 7 days limit.
#   - Set the required time limit for the job with --time parameter.
#     - Acceptable time formats include "minutes", "minutes:seconds", "hours:minutes:seconds", "days-hours", "days-hours:minutes" and "days-hours:minutes:seconds"
#   - Put this script and all the input file under the same directory.
#   - Set the required parameters, input/output file names below.
#   - If you do not want mail please remove the line that has --mail-type and --mail-user. If you do want to get notification emails, set your email address.
#   - Put this script and all the input file under the same directory.
#   - Submit this file using:
#      sbatch slurm_submit.sh
#
# -= Resources =-
#
#SBATCH --job-name=orthoMSA
#SBATCH --account=investor
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=1
#SBATCH --cpus-per-task=1
#SBATCH --qos=short_investor
#SBATCH --partition=short_investor
#SBATCH --mail-type=ALL
# #SBATCH --mail-user=bselcuk@sabanciuniv.edu
#SBATCH --array=0-1 #USE ARRAY FOR RUNNING JOBS IN PARALLEL
#SBATCH --open-mode=append


protein_array=(5HT1A DRD2 5HT1B ADRB1 ADA1D ADA1A ACM1 5HT1D ADA1B ACM3 DRD3 5HT7R ACM5 5HT1F ADA2B HRH2 5HT1E ACM4 ADA2A ADA2C ACM2 ADRB2 DRD1 5HT5A HRH1 ADRB3 DRD4 5HT2A DRD5 CCKAR 5HT2C SSR2 5HT4R 5HT2B 5HT6R SSR5 SSR1 OPRX OPRM SSR3 HRH3 SSR4 OPRK OPRD GASR TAAR1 NK3R AA2AR NK1R OX2R TAAR9 APJ QRFPR CCR1 NK2R BRS3 NPY1R OX1R GALR1 HRH4 BKRB2 CXCR5 CXCR1 AGTR2 AGTR1 TAAR6 OPN4 NPFF1 NMBR NPFF2 CXCR3 GRPR GHSR CX3C1 GALR2 CXCR2 CXCR4 TAAR5 AA2BR CCR2 TAAR2 CCR3 NPY2R NTR1 NMUR2 CCR4 PRLHR LPAR4 NMUR1 CCR5 TAAR8 NPBW2 BKRB1 GP183 LPAR6 CCR7 GPR83 AA1R GP101 ACKR3 TRFR TAAR3 GPR63 CCR6 GPR17 V2R GPR45 KISSR V1AR NPBW1 MCHR1 MTLR GALR3 MTR1B GPR15 ACKR4 NPY42 NPY4R V1BR CCR9 GP161 MTR1A MCHR2 CNR1 AA3R MTR1L CCR8 UR2R PKR1 OPSD CLTR2 OXYR PKR2 C5AR1 CLTR1 P2RY6 OPSX NPY5R PTAFR LT4R1 XCR1 GPR19 GPR4 OGR1 P2RY4 ACKR2 GPR25 OPSB LPAR5 RL3R1 CXCR6 C3AR CCR10 PAR1 GPR34 PAR3 PSYR GP135 CML1 GP182 GPER1 NPSR1 RL3R2 PAR2 P2RY2 S1PR1 GPR1 MC3R NPY6R P2RY1 PAR4 PE2R4 OPN5 OPSR OXGR1 FPR1 OPSG OPSG2 OPSG3 LPAR1 FPR2 P2RY8 FPR3 GPR31 GPR21 S1PR3 GP174 GNRHR EDNRB GPR52 FFAR4 GPR61 PD2R2 NTR2 SUCR1 GP119 GPR84 HCAR3 HCAR2 HCAR1 FSHR LPAR3 P2Y12 GPR33 GPR3 CNR2 GPR87 MC5R P2Y14 GPR26 GPR35 EDNRA GPR18 TSHR LSHR MC4R S1PR2 GPR6 LT4R2 TA2R OPN3 GPR12 OR2D2 LPAR2 S1PR5 O13C9 P2Y13 GP132 MSHR FFAR3 O13C2 OR2J1 OR2J2 GP173 OR1N2 GPR42 GPR85 ACTHR CCRL2 OR2D3 OR5V1 O13C8 OR1N1 O2AG2 O2AG1 O2T34 OR1C1 OR7D2 O11A1 P2Y10 OR2W1 O13C3 OR2J3 FFAR2 O13C4 OXER1 OR2T3 S1PR4 GPR37 O7E24 O2A14 A0A2R8YEH3 OR6M1 OR7C1 GPR32 OR7D4 GPR20 OR2B2 A0A4W9AIG4 GPR39 P2Y11 A0A2R8YEV3 OR2A1 OR3A1 O10A5 A0A126GWI2 A0A2R8YEG4 OR2S1 OR2M4 OR1M1 O13C5 O2A12 GP176 OR1E1 OR1D5 OR2B3 OR2G6 OR2C1 OR7C2 OR6Y1 A0A126GWB0 OR2A2 O10A2 O10A7 OR1D2 GPR78 OR1FC OR5P2 O2T33 OR2T7 O2A25 O6C74 O2T10 OR1J4 OR2C3 OR2A5 OR3A3 OR2B6 OR1D4 OR1P1 OR1A1 O2T27 O10Q1 OR2V2 OR2BB OR2T2 OR2T8 OR2H2 O10A6 O12D1 OR4S1 O2AJ1 OR6C2 OR4K3 OR6N2 O11H2 O2AK2 OR1J2 O10C1 GNRR2 OR2T4 O10K1 OR2L3 OR2T1 O13C7 O10J1 OR7A5 OR7AH O6C70 OR1L6 OR1I1 OR2W6 OR5P3 OR5BL OR2F1 OR5B2 OR1L8 OR1J1 GP171 O4A15 OR2L8 OR1A2 OR2K2 OR6C3 OR2M3 OR4S2 OR1G1 OR8A1 OR2M7 OR2M5 O10G7 OR1K1 OR1F1 OR4C6 OR6C4 GPR55 OR7AA OR2Z1 OR2H1 O2T35 OR2T5 O2T29 O14J1 O14L1 PE2R3 OR1L1 O2T12 O4F17 OR8U9 OR4F5 OR1L4 O2AP1 OR7A2 OR2L2 O10A4 OR2G3 O10P1 OR2LD OR6N1 OR2Y1 O2AT4 OR2T6 O51A4 OR2V1 GPR27 OR8D1 OR2L5 OR6C6 OR7G2 O14I1 OR8U1 OR5MA OR4F4 O10G4 OR4KH O10G9 OR2F2 O6C68 O13H1 O11H1 OR7G1 O10D4 OR2W3 OR2M2 O14A2 OR4L1 OR8J2 OR6C1 OR9K2 OR8B3 OR5M3 OR4K2 O6C75 RXFP1 O14AG O11HC OR4M1 PE2R2 OR1B1 OR8U8 OR8B2 O10J5 O2T11 OR5MB OR5K1 O11G2 OR4F6 O10D3 GPR22 OR5M1 OR5M9 OR6Q1 O13D1 OR6J1 O2AE1 OR6S1 O13J1 OR1S1 O13F1 O10A3 OR5B3 OR5BC O10V1 OR6K6 OR4K1 OR8B8 OR3A2 OR5R1 OR1L3 O10Z1 O5AS1 OR5BH OR8H1 O51I2 OR2B8 O11H6 OR4N2 O6C65 O10J3 O52L2 PI2R G32P1 OR4D5 OR5H1 OR9Q2 C5AR2 O51E1 OR4D9 OR8B4 O51A2 O51A7 OR8D4 OR1F2 OR4F3 OR5M8 OR4CF O10H1 O10G3 OR4Q3 OR1E2 O51T1 OR4KF OR2I1 OR8H3 ORN4C O52B6 OR4KE O5H15 O51G2 O10W1 O10G8 O4F21 OR4N5 O4F15 A0A0G2JNH3 OR4N4 OR6T1 O51G1 OR9I1 OR9G4 OR8G1 O51L1 O10H2 OR8J3 OR6K3 O10AD OR4P4 O8G2P OR4KD OR4DA O5H14 OR1S2 OR8BC OR8D2 O52D1 O11H7 O6C76 O51V1 O11H4 O51M1 OR4Q2 OR4CB O11L1 OR4E1 OR5A2 O10K2 OR6A2 O5AR1 O12D2 O10J6 OR7G3 OR4D1 O10AG OR8J1 O13G1 OR83P O5AN1 O52Z1 O51E2 O10R2 A0A2R8Y4L6 OR9A4 OR8H2 OR5T2 O10H4 OR3A4 OR1Q1 OR8K5 RXFP2 O13A1 OR6P1 OR4B1 OR8I2 O10J4 O5AC2 OR4E2 G37L1 OR4DB O5AC1 O14CZ OR5T1 O10S1 OR6B1 RGR OR9A2 OR4K5 OR4CG OR6V1 O12D3 OR5H8 O52K1 OR5K2 O52L1 OR4C3 OR6F1 O51I1 O14K1 OR4D6 OR2A4 OR5DI OR5L2 GP152 O5AK3 OR5W2 O10H5 OR5H6 OR5G3 PF2R O52B4 O51B2 O10G2 O51B5 OR5A1 OR4X1 GP139 OR5DE OR8K3 OR4D2 O52B2 OR9Q1 O5AK2 OR8K1 OR5I1 A0A3B3IT45 OR6B2 OR5K4 OR4CC OR8G5 O10G6 ORM2B OR5DD OR4M2 OR6X1 O51S1 OR5F1 O10T2 O52P1 OR5H2 OR2A7 OR2W5 O52E4 OR5C1 OR9G9 OR9G1 GPR82 O52N4 OR8S1 GPR75 O52M1 OR1E3 OR6B3 O5AU1 OR9A1 O52I1 OR5L1 OR4CD FFAR1 PE2R1 O5AP2 OR4A4 GP142 O10AC O10H3 O51D1 OR4A5 PD2R O51F2 O52N2 O52E8 O4A47 OR6K2 O52E5 O52K2 O52J3 OR5DG O52I2 O52H1 O10X1 GPR88 O51F1 O52N5 OR5T3 O52R1 OR2G2 A0A286YEU6 O51Q1 O5AL1 GP162 O4C46 OR4X2 A0A2R8YED5 MAS O13C6 O56B2 O56B1 O56A5 GP150 O51B6 GP151 OR5K3 O51B4 GP148 O52A1 O52A5 O51H1 O56B4 O4A16 O56A4 O52E2 GP153 O56A3 OR5J2 OR4A8 GPBAR GPR62 MRGX4 O52N1 O52W1 OR4C5 MRGX1 O56A1 MRGRD O52E6 O52A4 O52E1 GP146 MRGX2 LGR4 GP141 MRGX3 O51J1 O4C45 MRGRE LGR5 MRGRF GP149 MAS1L LGR6 GP160 MRGRG ACKR1)

#protein_array=(CASR GABR2 GRM3 GRM2 GRM6 GRM7 GRM4 GRM8 GABR1 GRM5 GRM1 GPC6A GPC5B GP179 GP158 TS1R2 TS1R1 GPC5C GP156 TS1R3 GPC5D RAI3)

#protein_array=(FZD1 FZD2 FZD3 FZD4 FZD5 FZD6 FZD7 FZD8 FZD9 FZD10 SMO)

#protein_array=(PACR VIPR1 SCTR PTH1R PTH2R VIPR2 CALCR GIPR GHRHR GLR GLP2R CALRL GLP1R AGRL3 CRFR2 AGRE5 AGRL2 CRFR1 AGRL1 AGRE1 AGRB1 AGRG2 AGRB3 AGRE3 AGRL4 CELR3 AGRD1 CELR1 AGRE4 AGRE2 AGRG4 AGRG6 CELR2 AGRD2 AGRF1 AGRF5 AGRG3 AGRF3 AGRF4 AGRG5 AGRG1 AGRF2 AGRA1 AGRA3 AGRV1 AGRA2 AGRB2 AGRG7)

#protein_array=(T2R43 T2R40 T2R41 T2R42 TA2R1 TA2R3 TA2R4 TA2R5 TA2R7 TA2R8 TA2R9 T2R10 T2R13 T2R14 T2R16 T2R19 T2R20 T2R30 T2R31 T2R38 T2R39 T2R45 T2R46 T2R50 T2R60)


protein=${protein_array[$SLURM_ARRAY_TASK_ID]}
date=26-10-2022
cd $protein"_"$date"_outgroup"

directory="/cta/users/bselcuk/GPCRA/GPCR_atlas_26-10-2022/"

module load ete-3.1.1
module load py-pip-19.3-gcc-5.4.0-goul4og
python $directory"Scripts/subtree_alignment.py" --tree $protein"_subtree_"$date"_orthologs_ordered.nwk" --msa $protein"_subtreeMSA"$date".fasta"  --out $protein"_"$date"_orthologs_orderedMSA.fasta" >> $protein"_"$date"_pipeline.log"

module load trimal-1.4.1-gcc-9.2.0-m27o55z
trimal -in $protein"_"$date"_orthologs_orderedMSA.fasta" -out $protein"_"$date"_orthologs_orderedMSA_noallgaps.fasta" -noallgaps